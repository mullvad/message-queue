# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/introduction/learn-gitpod/gitpod-yaml)
# and commit this file to your remote git repository to share the goodness with others.

# Learn more from ready-to-use templates: https://www.gitpod.io/docs/introduction/getting-started/quickstart

tasks:
  - name: Redis Server
    init: |
      sudo apt update -y
      sudo apt install redis-server -y
    command: |
      clear
      redis-server

  - name: Redis CLI
    command: |
      clear
      gp ports await 6379
      redis-cli
  
  - name: Message Queue Server
    init: go get
    command: |
      clear
      gp ports await 9102
      go run . -redis-address=127.0.0.1:6379 -channels=main,test

  - name: Websocat WS Client
    init: |
      sudo wget https://github.com/vi/websocat/releases/download/v1.11.0/websocat.x86_64-unknown-linux-musl -O /bin/websocat
      sudo chmod +x /bin/websocat
    command: |
      clear
      gp ports await 8080
      echo "Connected to 'main' channel"
      websocat ws://localhost:8080/channel/main --protocol message-queue-v1 

  - name: StatsD Exporter Server
    init: docker pull prom/statsd-exporter
    command: | 
      clear
      gp ports await 9090
      docker run --network host \
      -p 9123:9102 -p 8125:8125/udp prom/statsd-exporter \
      --statsd.listen-udp=:8125 --web.listen-address=:9102

  - name: Prometheus Server
    init: |
      docker pull prom/prometheus
    command: |
      clear
      docker run --network=host -p 9090:9090 -v ./prometheus.yml:/etc/prometheus/prometheus.yml prom/prometheus
